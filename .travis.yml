# .travis.yml
language: ruby
rvm:
  - ruby-head
#before_install:
#  - bundle exec gem update
#  - bundle exec update thread_safe
bundler_args: --without production
script:
  - RAILS_ENV=test
  - bundle exec rake db:migrate --trace
  - bundle exec rake db:test:prepare
#  - bundle exec rspec
#  - bundle exec rake cucumber

#Deploy en Heroku
deploy:
  provider: heroku
#  buildpack: ruby
  api_key:
    secure: SECURE="*"
  on:
    repo: matiasmasca/Novedades
    all_branches: true #Para que haga deploy ante cualquier rama, sino solo cuando cambia la master.

  run:
    - "rake db:drop"
    - "rake db:schema:load --trace"
    - "rake db:seed"
    - restart

#db:schema:load #creates tables and columns within the (existing) database following schema.rb
#db:setup #does db:create, db:schema:load, db:seed

#after_script:
#  # Install the Heroku gem (or the Heroku toolbelt)
#  - gem install heroku
#  # Add your Heroku git repo:
#  - git remote add heroku git@heroku.com:YOUR_HEROKU_APP.git
#  # Add your Heroku API key:
#  - export HEROKU_API_KEY=YOUR_HEROKU_API_KEY_HERE
#  # Turn off warnings about SSH keys:
#  - echo "Host heroku.com" >> ~/.ssh/config
#  - echo "   StrictHostKeyChecking no" >> ~/.ssh/config
#  - echo "   CheckHostIP no" >> ~/.ssh/config
#  - echo "   UserKnownHostsFile=/dev/null" >> ~/.ssh/config
#  # Clear your current Heroku SSH keys:
#  - heroku keys:clear
#  # Add a new SSH key to Heroku
#  - yes | heroku keys:add
#  # Push to Heroku!
#  - yes | git push heroku master
